function convertirLien(e){return e.replace(/(https?:\/\/[^\s]+)/g,e=>`<a href="${e}" target="_blank">${e}</a>`)}function appliquerStyleSpecial(e){return e.replace(/\(\*(.*?)\*\)/g,"<strong>$1</strong>")}function traiterDescription(e){return convertirLien(appliquerStyleSpecial(e)).split("\n").join("<br>")}async function chargerArticles(){(await(await fetch("/articles")).json()).forEach(e=>{afficherArticle(e)})}function afficherArticle(e){var t=document.getElementById("blog-articles"),i=document.createElement("div"),n=(i.classList.add("article"),i.id="article-"+e._id,traiterDescription(e.description));i.innerHTML=`
    <h2>${e.titre}</h2>
    <img src="${e.image}" alt="${e.titre}" />
    <p class="description">
      ${n}
    </p>
    <div class="button-container">
      <button id="like-button-${e._id}" onclick="ajouterLike('${e._id}')">
        <i class="bx bx-like"></i> ${e.likes}
      </button>
      <button id="delete-button-${e._id}" data-clicks="0" onclick="compterClicsSuppression('${e._id}')">
        Supprimer cet article
      </button>
    </div>
  `,t.appendChild(i),(n=i.querySelector(".button-container")).style.display="flex",n.style.alignItems="center",n.style.gap="10px",(t=document.getElementById("like-button-"+e._id)).style.display="flex",t.style.alignItems="center",t.style.gap="5px",t.style.backgroundColor="#4CAF50",t.style.color="white",t.style.border="none",t.style.padding="10px 15px",t.style.cursor="pointer",t.style.marginRight="5px",t.style.borderRadius="5px",(i=document.getElementById("delete-button-"+e._id)).style.backgroundColor="white",i.style.color="white",i.style.border="none",i.style.padding="10px 15px",i.style.borderRadius="5px",i.style.cursor="default"}function compterClicsSuppression(e){var t=document.getElementById("delete-button-"+e),i=parseInt(t.getAttribute("data-clicks"))||0;t.setAttribute("data-clicks",i+=1),10===i&&supprimerArticle(e)}async function supprimerArticle(e){"Article supprimé"===(await(await fetch("/articles/"+e,{method:"DELETE"})).json()).message&&document.getElementById("article-"+e).remove()}async function ajouterLike(e){var t,i=JSON.parse(localStorage.getItem("likedArticles"))||[];i.includes(e)?alert("Vous avez déjà liké cet article."):(t=await(await fetch(`/articles/${e}/like`,{method:"POST"})).json())&&void 0!==t.likes&&(i.push(e),localStorage.setItem("likedArticles",JSON.stringify(i)),document.querySelector(`#article-${e} button`).innerHTML='<i class="bx bx-like"></i> '+t.likes)}async function ajouterCommentaire(e){var t=document.getElementById("comment-input-"+e).value;afficherCommentaires((await(await fetch(`/articles/${e}/comment`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"Utilisateur",text:t})})).json())._id)}async function afficherCommentaires(n){let e=await fetch("/articles/"+n),t=await e.json(),a=document.getElementById("comments-"+n);a.innerHTML="",t.comments.forEach(e=>{var t=traiterDescription(e.text),i=document.createElement("div");i.innerHTML=`
      <p><strong>${e.name}</strong>: ${t}</p>
      <button onclick="supprimerCommentaire('${n}', '${e._id}')">Supprimer</button>
    `,a.appendChild(i)})}async function supprimerCommentaire(e,t){"Commentaire supprimé"===(await(await fetch(`/articles/${e}/comment/`+t,{method:"DELETE"})).json()).message&&afficherCommentaires(e)}document.getElementById("articleForm").addEventListener("submit",async e=>{e.preventDefault();let t=document.getElementById("title").value,i=document.getElementById("description").value,n="",a;"url"===(e=document.getElementById("imageSource").value)?n=document.getElementById("imageUrl").value:"local"===e&&(e=document.getElementById("localImage").files[0])&&((a=new FormData).append("image",e),e=await fetch("/upload-image",{method:"POST",body:a}),n=(await e.json()).imageUrl),afficherArticle(await(await fetch("/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({titre:t,image:n,description:i})})).json()),document.getElementById("articleForm").reset()}),document.addEventListener("DOMContentLoaded",chargerArticles);